graph TD
    A["🎮 開始 Mega Man LoRA 訓練"] --> B["📋 檢查依賴項"]
    B --> C{"✅ 依賴項完整？"}
    C -->|否| D["❌ 安裝依賴項<br/>pip install -r requirements_megaman_lora.txt"]
    C -->|是| E["📁 準備訓練數據"]
    D --> E
    
    E --> F{"🖼️ 數據目錄存在？"}
    F -->|否| G["📂 創建 megaman_images 目錄<br/>添加圖像和描述文件"]
    F -->|是| H["🔍 檢查圖像文件"]
    G --> H
    
    H --> I{"📊 圖像數量充足？"}
    I -->|否| J["⚠️ 添加更多圖像<br/>建議 20+ 張"]
    I -->|是| K["⚙️ 選擇訓練配置"]
    J --> K
    
    K --> L["🏃 Fast<br/>512px, 800 steps<br/>rank=4, α=16"]
    K --> M["⚖️ Balanced<br/>512px, 1500 steps<br/>rank=8, α=32"]
    K --> N["🎨 Quality<br/>768px, 2500 steps<br/>rank=16, α=64"]
    
    L --> O["🚀 開始訓練"]
    M --> O
    N --> O
    
    O --> P["📥 載入 Stable Diffusion"]
    P --> Q["🔧 設置 LoRA 適配器"]
    Q --> R["💾 處理訓練數據"]
    R --> S["🔄 訓練循環"]
    
    S --> T["🖼️ 編碼圖像到潛在空間"]
    T --> U["🎯 添加噪聲"]
    U --> V["🤖 UNet 預測去噪"]
    V --> W["📉 計算損失"]
    W --> X["⬅️ 反向傳播"]
    X --> Y["🔄 更新 LoRA 權重"]
    
    Y --> Z{"🎯 達到最大步數？"}
    Z -->|否| AA["📊 記錄進度"]
    AA --> AB{"🖼️ 生成示例？"}
    AB -->|是| AC["🎨 生成示例圖像"]
    AB -->|否| S
    AC --> S
    
    Z -->|是| AD["💾 保存最終模型"]
    AD --> AE["✅ 訓練完成"]
    
    AE --> AF["🎨 生成圖像"]
    AF --> AG["python generate_megaman.py"]
    AG --> AH["🖼️ 查看生成結果"]
    AH --> AI["🎉 享受 Mega Man 圖像！"]